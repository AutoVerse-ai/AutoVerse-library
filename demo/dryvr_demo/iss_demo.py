from origin_agent_heat import iss_agent
from verse.scenario import Scenario, ScenarioConfig
from verse.plotter.plotter2D import *
from verse.sensor.example_sensor.craft_sensor import CraftSensor

import plotly.graph_objects as go
from enum import Enum, auto
import time

class CraftMode(Enum):
    Default = auto()

if __name__ == "__main__":
    input_code_name = './demo/dryvr_demo/iss_controller.py'
    #scenario = Scenario()
    scenario = Scenario()


    car =  iss_agent('test', file_name=input_code_name)
    scenario.add_agent(car)

    # modify mode list input
    scenario.set_init(
        [
            [[-0.0000013, -0.0000006,-0.0000005, -0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,-0.0001000,0,0.8,0.9,0], [0.0000013,0.0000006,0.0000005,  0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,0.0001000,.1,1,1,0]],
        ],
        [
            tuple([CraftMode.Default]),
        ]
    )

    # traces = scenario.simulate(3.64, .01)
    # fig = go.Figure()
    # fig = simulation_anime(traces, None, fig, 1, 2, [
    #                        1, 2], 'lines', 'trace', sample_rate=1)
    # fig.show()


    start_time = time.time()

    traces = scenario.verify(20, 0.01)
    run_time = time.time() - start_time

    print({
        "tool": "verse",
        "benchmark": "SpaceStation",
        "setup": "ISS02",
        "result": "1",
        "time": run_time,
        "metric2": "n/a",
        "metric3": "n/a",
    })
    fig = go.Figure()
    fig = reachtube_tree(traces, None, fig, 0, 3, [0, 3],
                         'lines', 'trace')
    fig.update_layout(
        xaxis_title="t", yaxis_title="y3"
    )
    fig.update_xaxes(
        range=[0,20])
    #fig.show()

    scenario = Scenario()

    car = iss_agent('test', file_name=input_code_name)
    scenario.add_agent(car)

    # modify mode list input
    scenario.set_init(
        [
            [[-0.0000013, -0.0000006, -0.0000017, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000, -0.0001000,
              -0.0001000, 0, 0.8, 0.9, 0],
             [0.0000013, 0.0000006, 0.0000017, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000, 0.0001000,
              0.0001000, 0.0001000, 0.0001000, .1, 1, 1, 0]],
        ],
        [
            tuple([CraftMode.Default]),
        ]
    )

    # traces = scenario.simulate(3.64, .01)
    # fig = go.Figure()
    # fig = simulation_anime(traces, None, fig, 1, 2, [
    #                        1, 2], 'lines', 'trace', sample_rate=1)
    # fig.show()

    start_time = time.time()

    traces = scenario.verify(20, 0.01)
    run_time = time.time() - start_time

    print({
        "tool": "verse",
        "benchmark": "SpaceStation",
        "setup": "ISSU02",
        "result": "1",
        "time": run_time,
        "metric2": "n/a",
        "metric3": "n/a",
    })
    fig = go.Figure()
    fig = reachtube_tree(traces, None, fig, 0, 3, [0, 3],
                         'lines', 'trace')
    fig.update_layout(
        xaxis_title="t", yaxis_title="y3"
    )

    #fig.show()

